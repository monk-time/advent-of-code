from aoc12 import pad, parse, solve, stabilize, str_n_gens, sum_of_pots_at_gen

sample = """initial state: #..#.#..##......###...###

...## => #
..#.. => #
.#... => #
.#.#. => #
.#.## => #
.##.. => #
.#### => #
#.#.# => #
#.### => #
##.#. => #
##.## => #
###.. => #
###.# => #
####. => #"""


def test_parse():
    assert parse(sample) == (
        {'...##', '..#..', '.#...', '.#.#.', '.#.##', '.##..', '.####',
         '#.#.#', '#.###', '##.#.', '##.##', '###..', '###.#', '####.'},
        ('....#..#.#..##......###...###....', 4))


def test_pad():
    assert pad('#...#.', 3) == ('....#...#....', 7)
    assert pad('#...#.', 0) == ('....#...#....', 4)
    assert pad('.#...#.', 0) == ('....#...#....', 3)
    assert pad('..#...#.', 0) == ('....#...#....', 2)
    assert pad('...#...#.', 0) == ('....#...#....', 1)
    assert pad('....#...#.', 0) == ('....#...#....', 0)
    assert pad('.....#...#.', 0) == ('....#...#....', -1)
    assert pad('......#...#.', 0) == ('....#...#....', -2)
    assert pad('....#.#', 0) == ('....#.#....', 0)
    assert pad('....#.#.', 0) == ('....#.#....', 0)
    assert pad('....#.#..', 0) == ('....#.#....', 0)
    assert pad('....#.#...', 0) == ('....#.#....', 0)
    assert pad('....#.#....', 0) == ('....#.#....', 0)
    assert pad('....#.#.....', 0) == ('....#.#....', 0)
    assert pad('...#.#....', 0) == ('....#.#....', 1)
    assert pad('..#.#....', 0) == ('....#.#....', 2)
    assert pad('.#.#....', 0) == ('....#.#....', 3)
    assert pad('#.#....', 0) == ('....#.#....', 4)


def test_evolve():
    rules, state = parse(sample)
    lines = str_n_gens(20, rules, *state)
    assert lines == [
        ' 0: ......#..#.#..##......###...###..............',
        ' 1: ......#...#....#.....#..#..#..#..............',
        ' 2: ......##..##...##....#..#..#..##.............',
        ' 3: .....#.#...#..#.#....#..#..#...#.............',
        ' 4: ......#.#..#...#.#...#..#..##..##............',
        ' 5: .......#...##...#.#..#..#...#...#............',
        ' 6: .......##.#.#....#...#..##..##..##...........',
        ' 7: ......#..###.#...##..#...#...#...#...........',
        ' 8: ......#....##.#.#.#..##..##..##..##..........',
        ' 9: ......##..#..#####....#...#...#...#..........',
        '10: .....#.#..#...#.##....##..##..##..##.........',
        '11: ......#...##...#.#...#.#...#...#...#.........',
        '12: ......##.#.#....#.#...#.#..##..##..##........',
        '13: .....#..###.#....#.#...#....#...#...#........',
        '14: .....#....##.#....#.#..##...##..##..##.......',
        '15: .....##..#..#.#....#....#..#.#...#...#.......',
        '16: ....#.#..#...#.#...##...#...#.#..##..##......',
        '17: .....#...##...#.#.#.#...##...#....#...#......',
        '18: .....##.#.#....#####.#.#.#...##...##..##.....',
        '19: ....#..###.#..#.#.#######.#.#.#..#.#...#.....',
        '20: ....#....##....#####...#######....#.#..##....',
    ]


def test_sum_of_pots_at_gen():
    rules, state = parse(sample)
    assert sum_of_pots_at_gen(20, rules, *state) == 325


def test_stabilize():
    rules, state = parse(sample)
    assert stabilize(rules, *state) == (91, 1194, 20)


def test_solve():
    assert solve() == (3494, 2850000002454)
